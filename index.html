
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<title>gxeditor</title>
	<meta name="title" content="gxeditor" />
	<meta property="og:title" content="gxeditor" />
	<meta name="description" content="A game XML editor for the web" />
	<meta property="og:description" content="A game XML editor for the web" />
    <meta charset="UTF-8"/>

	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="xonomy-3.5.0/xonomy.js"></script>
	<link type="text/css" rel="stylesheet" href="xonomy-3.5.0/xonomy.css"/>
	<script type="text/javascript">
	function setEditor(what) {
		$(".setter").removeClass("current");
		var editor=document.getElementById("editor");
		if(what=="school") {
			var xml=schoolXml; var spec=schoolSpec;
			$("#setterSchool").addClass("current");
		}
		else if(what=="article") {
			var xml=articleXml; var spec=articleSpec;
			$("#setterArticle").addClass("current");
		}
		setMode();
		Xonomy.lang="en";
		Xonomy.render(xml, editor, spec);
	}
	function setMode() {
		var mode=$("input[name='mode']:checked").val();
		Xonomy.setMode(mode);
	}
	</script>
	
</head>
<body onload="setEditor('school')">

<div class="envelope">
	<div class="setters">
		<a href="javascript:setEditor('school')" class="setter" id="setterSchool">XML data demo</a>
		<a href="javascript:setEditor('article')" class="setter" id="setterArticle">XML document demo</a>
		<span class="radios">
			<label onclick="setMode()"><input type="radio" name="mode" value="nerd" id="chkModeNerd" checked="checked"/>nerd mode</label>
			<label onclick="setMode()"><input type="radio" name="mode" value="laic" id="chkModeLaic"/>laic mode</label>
		</span>
	</div>
	<div class="editorContainer">
		<div id="editor"></div>
	</div>
	<div class="submitters">
		<button class="submitter" onclick="alert(Xonomy.harvest())">Get XML</button>
	</div>
</div>

<script type="text/javascript">
var schoolXml="<school name='Saint Tibulus&apos;s National School'><teachers><person name='Clara O&apos;Lara' sex='f'/><person name='Billybob Smythe' sex='m'/></teachers><students><person name='Mish Vargo' sex='f'/><person name='Iwanna Beer' sex='f'/><person name='Vern Lorn' sex='m'/><person name='Charlie McGillycuddy' sex='m' age='-8.5'/></students></school>";
var schoolSpec={
	onchange: function(){
		//console.log("Ah been chaaanged!");
	},
	validate: function(jsElement){
		if(typeof(jsElement)=="string") jsElement=Xonomy.xml2js(jsElement);
		var valid=true;
		var elementSpec=this.elements[jsElement.name];
		if(elementSpec.validate) {
			elementSpec.validate(jsElement); //validate the element
		}
		for(var iAttribute=0; iAttribute<jsElement.attributes.length; iAttribute++) {
			var jsAttribute=jsElement.attributes[iAttribute];
			var attributeSpec=elementSpec.attributes[jsAttribute.name];
			if(attributeSpec.validate) {
				if(!attributeSpec.validate(jsAttribute)) valid=false; //validate the attribute
			}
		}
		for(var iChild=0; iChild<jsElement.children.length; iChild++) {
			if(jsElement.children[iChild].type=="element") {
				var jsChild=jsElement.children[iChild];
				if(!this.validate(jsChild)) valid=false; //recurse to the child element
			}
		}
		return valid;
	},
	elements: { 
		"school": {
			menu: [{
				caption: "Add @id",
				action: Xonomy.newAttribute,
				actionParameter: {name: "id", value: ""},
				hideIf: function(jsElement){return jsElement.hasAttribute("id")}
			}],
			attributes: {
				"id": {
					asker: Xonomy.askString,
					askerParameter: {},
					menu: [{
						caption: "Delete",
						action: Xonomy.deleteAttribute,
						actionParameter: null,
						hideIf: function(jsAttribute){return false}
					}],
					validate: function(jsAttribute) {
						if($.trim(jsAttribute.value)=="") {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "The @id attribute should not be empty."});
							return false;
						}
						return true;
					},
				},
				"name": {
					asker: Xonomy.askString,
					askerParameter: {},
					menu: [],
					validate: function(jsAttribute) {
						if($.trim(jsAttribute.value)=="") {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "The @name attribute should not be empty."});
							return false;
						}
						return true;
					},
					//isReadOnly: function(jsAttribute){return true},
					//isInvisible: function(jsAttribute){return true},
				}
			},
			collapsed: function(jsElement){return false}
		},
		"teachers": {
			backgroundColour: "#ffd6d6",
			menu: [{
				caption: "New <person>",
				action: Xonomy.newElementChild,
				actionParameter: "<person name='' sex=''/>",
				hideIf: function(jsElement){return false}
			}],
			collapsed: function(jsElement){return false},
		},
		"students": {
			backgroundColour: "#d6d6ff",
			menu: [{
				caption: "New <person>",
				action: Xonomy.newElementChild,
				actionParameter: "<person name='' sex=''/>",
				hideIf: function(jsElement){return false}
			}],
			collapsed: function(jsElement){return false}
		},
		"person": {
			//isReadOnly: function(jsMe){return true},
			//isInvisible: function(jsMe){return true},
			//displayName: "člověk",
			canDropTo: ["teachers", "students"],
			localDropOnly: false,
			menu: [
				{	caption: "New <person> before this",
					action: Xonomy.newElementBefore,
					actionParameter: "<person name='' sex=''/>",
					hideIf: function(jsElement){return false}
				},
				{	caption: "New <person> after this",
					action: Xonomy.newElementAfter,
					actionParameter: "<person name='' sex=''/>",
					hideIf: function(jsElement){return false}
				},
				{	caption: "Add @age",
					action: Xonomy.newAttribute,
					actionParameter: {name: "age", value: ""},
					hideIf: function(jsElement){return jsElement.hasAttribute("age")}
				},
				{	caption: "Delete",
					action: Xonomy.deleteElement,
					actionParameter: null,
					hideIf: function(jsElement){return false}
				}
			],
			attributes: {
				"name": {
					asker: Xonomy.askString,
					askerParameter: {},
					menu: [],
					validate: function(jsAttribute) {
						if($.trim(jsAttribute.value)=="") {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "The @name attribute should not be empty."});
							return false;
						}
						return true;
					},
				},
				"sex": {
					shy: false,
					asker: Xonomy.askPicklist,
					askerParameter: [
						{value: "m", xdisplayValue: "muž", caption: "male"},
						{value: "f", xdisplayValue: "žen", caption: "female"},
						{value: "x", xdisplayValue: "jin", caption: "it's complicated"}
					],
					caption: function(jsMe){
						if(jsMe.value=="m") return "male";
						if(jsMe.value=="f") return "female";
						if(jsMe.value=="x") return "it's complicated";
					},
					// displayName: "pohlaví",
					// displayValue: function(jsMe){
						// if(jsMe.value=="m") return "muž";
						// if(jsMe.value=="f") return "žen";
						// if(jsMe.value=="x") return "jin";
						// return jsMe.value;
					// },
					menu: [],
					validate: function(jsAttribute) {
						if($.trim(jsAttribute.value)=="") {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "The @sex attribute should not be empty."});
							return false;
						}
						return true;
					},
				},
				"age": {
					shy: false,
					asker: Xonomy.askString,
					askerParameter: null,
					menu: [{
						caption: "Delete",
						action: Xonomy.deleteAttribute,
						actionParameter: null,
						hideIf: function(jsAttribute){return false}
					}],
					validate: function(jsAttribute) {
						if(!/^[0-9]+$/g.test(jsAttribute.value)) {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "The @age attribute should be a whole number greater than zero."});
							return false;
						}
						return true;
					},
				},
			},
			collapsed: function(jsElement){return false}
		}
	}
};
var articleXml="<article id='' language='en'><title>Introduction</title><body><paragraph><b>Gleann Cholm Cille</b> (anglicized as <b>Glencolumbkille</b>) is a coastal district in the southwest <i>Gaeltacht</i> of County Donegal, Ireland.</paragraph><paragraph>Gleann Cholm Cille is still an <a href='http://www.potafocal.com/'>Irish</a>-speaking community but English has been steadily replacing Irish as the main language, with only 34% of the people speaking Irish on a daily basis in 2002.</paragraph><paragraph>Cashel (Irish: <i>An Caiseal</i>) is the main village in the district.</paragraph></body></article>";
var articleSpec={
	onchange: function(jsSurrogate){
		//console.log(jsSurrogate.parent());
	},
	validate: function(jsElement){
		if(typeof(jsElement)=="string") jsElement=Xonomy.xml2js(jsElement);
		var valid=true;
		var elementSpec=this.elements[jsElement.name];
		if(elementSpec.validate) {
			elementSpec.validate(jsElement); //validate the element
		}
		for(var iAttribute=0; iAttribute<jsElement.attributes.length; iAttribute++) {
			var jsAttribute=jsElement.attributes[iAttribute];
			var attributeSpec=elementSpec.attributes[jsAttribute.name];
			if(attributeSpec.validate) {
				if(!attributeSpec.validate(jsAttribute)) valid=false; //validate the attribute
			}
		}
		for(var iChild=0; iChild<jsElement.children.length; iChild++) {
			if(jsElement.children[iChild].type=="element") {
				var jsChild=jsElement.children[iChild];
				if(!this.validate(jsChild)) valid=false; //recurse to the child element
			}
		}
		return valid;
	},
	elements: {

		//top-level structure:
		"article": {
			validate: function(jsElement) {
				if(!jsElement.hasAttribute("id")) {
					Xonomy.warnings.push({htmlID: jsElement.htmlID, text: "This element is missing an @id attribute."});
					return false;
				}
				return true;
			},
			attributes: {
				"id": {
					asker: Xonomy.askString,
					askerParameter: {},
					menu: [],
					validate: function(jsAttribute) {
						if($.trim(jsAttribute.value)=="") {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "en: The @id attribute should not be empty. | ga: Ní cheadaítear an aitreabúid @id a bheith folamh."});
							return false;
						}
						return true;
					},
				},
				"language": {
					asker: Xonomy.askPicklist,
					askerParameter: [
						{value: "en", caption: "en: English | de: Englisch    | ga: Béarla"},
						{value: "ga", caption: "en: Irish   | de: Irisch      | ga: Gaeilge"},
						{value: "de", caption: "en: German  | de: Deutsch     | ga: Gearmáinis"},
						{value: "cs", caption: "en: Czech   | de: Tschechisch | ga: Seicis"},
					],
					caption: function(jsMe){
						if(jsMe.value=="en") return "en: English | de: Englisch    | ga: Béarla";
						if(jsMe.value=="ga") return "en: Irish   | de: Irisch      | ga: Gaeilge";
						if(jsMe.value=="de") return "en: German  | de: Deutsch     | ga: Gearmáinis";
						if(jsMe.value=="cs") return "en: Czech   | de: Tschechisch | ga: Seicis";
					},
					menu: [],
					validate: function(jsAttribute) {
						var has=false;
						for(var i=0; i<this.askerParameter.length; i++) {
							if(this.askerParameter[i].value==jsAttribute.value) has=true;
						}
						if(!has) {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "@\""+jsAttribute.value+"\" is not a valid value for the @language attribute."});
							return false;
						}
						return true;
					},
				}
			},
			menu: [],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsed: function(jsElement){return false},
			oneliner: false,
			hasText: false,
			inlineMenu: []
		},
		"title": {
			attributes: {},
			menu: [],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsible: false,
			oneliner: true,
			hasText: true,
			inlineMenu: [],
			asker: Xonomy.askPicklist,
			askerParameter: ["Introduction", "History", "Current Status", "Conclusion"],
		},
		"body": {
			backgroundColour: "#ffd6d6",
			attributes: {},
			menu: [
				{caption: "en: New <paragraph> | ga: <paragraph> nua", action: Xonomy.newElementChild, actionParameter: "<paragraph/>", hideIf: function(jsElement){return false}}
			],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsed: function(jsElement){return false},
			oneliner: false,
			hasText: false,
			inlineMenu: [],
		},

		//block-level textual elements:
		"paragraph": {
			isReadOnly: false,
			attributes: {},
			menu: [
				{caption: "New <paragraph> before this", action: Xonomy.newElementBefore, actionParameter: "<paragraph/>", hideIf: function(jsElement){return false}},
				{caption: "New <paragraph> after this", action: Xonomy.newElementAfter, actionParameter: "<paragraph/>", hideIf: function(jsElement){return false}},
				{caption: "Delete", action: Xonomy.deleteElement, actionParameter: null, hideIf: function(jsElement){return false}}
			],
			canDropTo: ["body"],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsed: function(jsElement){return false},
			oneliner: false,
			hasText: true,
			inlineMenu: [
				{caption: "<i> (italic)", action: Xonomy.wrap, actionParameter: {template: "<i>$</i>", placeholder: "$"}, hideIf: function(jsElement){return false}},
				{caption: "<b> (bold)", action: Xonomy.wrap, actionParameter: {template: "<b>$</b>", placeholder: "$"}, hideIf: function(jsElement){return false}},
				{caption: "<u> (underline)", action: Xonomy.wrap, actionParameter: {template: "<u>$</u>", placeholder: "$"}, hideIf: function(jsElement){return false}},
				{caption: "<a> (external link)", action: Xonomy.wrap, actionParameter: {template: "<a href=''>$</a>", placeholder: "$"}, hideIf: function(jsElement){return false}},
			]
		},


		//inline textual elements:
		"i": {
			backgroundColour: "#d6ffd6",
			attributes: {},
			menu: [
				{caption: "Unwrap", action: Xonomy.unwrap, actionParameter: null, hideIf: function(jsElement){return false}}
			],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsible: false,
			oneliner: true,
			hasText: true,
			inlineMenu: [
				{caption: "<b> (bold)", action: Xonomy.wrap, actionParameter: {template: "<b>$</b>", placeholder: "$"}, hideIf: function(jsElement){return false}},
				{caption: "<u> (underline)", action: Xonomy.wrap, actionParameter: {template: "<u>$</u>", placeholder: "$"}, hideIf: function(jsElement){return false}}
			]
		},
		"b": {
			backgroundColour: "#d6ffd6",
			attributes: {},
			menu: [
				{caption: "Unwrap", action: Xonomy.unwrap, actionParameter: null, hideIf: function(jsElement){return false}}
			],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsible: false,
			oneliner: true,
			hasText: true,
			inlineMenu: [
				{caption: "<i> (italic)", action: Xonomy.wrap, actionParameter: {template: "<i>$</i>", placeholder: "$"}, hideIf: function(jsElement){return false}},
				{caption: "<u> (underline)", action: Xonomy.wrap, actionParameter: {template: "<u>$</u>", placeholder: "$"}, hideIf: function(jsElement){return false}}
			]
		},
		"u": {
			backgroundColour: "#d6ffd6",
			attributes: {},
			menu: [
				{caption: "Unwrap", action: Xonomy.unwrap, actionParameter: null, hideIf: function(jsElement){return false}}
			],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsible: false,
			oneliner: true,
			hasText: true,
			inlineMenu: [
				{caption: "<i> (italic)", action: Xonomy.wrap, actionParameter: {template: "<i>$</i>", placeholder: "$"}, hideIf: function(jsElement){return false}},
				{caption: "<b> (bold)", action: Xonomy.wrap, actionParameter: {template: "<b>$</b>", placeholder: "$"}, hideIf: function(jsElement){return false}}
			]
		},
		"a": { //an external link
			backgroundColour: "#d6ffd6",
			attributes: {
				"href": {
					asker: Xonomy.askString,
					askerParameter: null,
					explainer: null,
					menu: [],
					validate: function(jsAttribute) {
						if($.trim(jsAttribute.value)=="") {
							Xonomy.warnings.push({htmlID: jsAttribute.htmlID, text: "The @href attribute should not be empty."});
							return false;
						}
						return true;
					},
				}
			},
			menu: [
				{caption: "Unwrap", action: Xonomy.unwrap, actionParameter: null, hideIf: function(jsElement){return false}}
			],
			canDropTo: [],
			mustBeAfter: [],
			mustBeBefore: [],
			collapsed: function(jsElement){return true},
			oneliner: true,
			hasText: true,
			inlineMenu: []
		},


	}
};
</script>

</body>
</html>